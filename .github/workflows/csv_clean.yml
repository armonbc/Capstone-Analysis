name: 2. Cleaning CSV Operations

on: 
  workflow_dispatch:

jobs:
  rscript_job:
    runs-on: ubuntu-latest
    steps:
    - name: List current dir....
      run: ls -la "/home/runner/work/Capstone-Analysis/Capstone-Analysis"
    
    - name: checkout repo content
      uses: actions/checkout@v2 # checkout the repository content
  
    - name: Unzip Files
      run: |
        wget -O Uncleaned_Datasets.zip https://github.com/armonbc/Capstone-Analysis/archive/refs/tags/v2023.03.01.Uncleaned_Datasets.zip
        unzip Uncleaned_Datasets.zip -d "original_datasets"
        ls -la "original_datasets/"
 
    - name: Install R and its Dependencies
      run: |
        sudo apt-get update
        sudo apt-get install r-base
        Rscript -e 'install.packages(c("ggplot2"))'

    - name: Cleaning CSV files
      run: |
        cd "Rscripts" && Rscript dataset_sortfilterlog.R

    - name: Create Release
      id: create_release
      uses: softprops/action-gh-release@v1
      with:
        files: |
          cleaned_datasets/*
        tag_name: v2023.03.01.Cleaned_Datasets
        name: Cleaned Datasets (2022-02 to 2023-03)
        body: |
          This is the second release of our project.
          It includes several cleaned datasets.
        prerelease: true
      env:
        GITHUB_TOKEN: ${{ secrets.PUBLIC_REPO_ACCESS_TOKEN }}
